# Windows Porting Initiative Status

Last updated: 2026-02-10
Owner: Codetracer engineering

## Scope and Assumptions

- Goal: make the non-Nix development and build workflow reliable on Windows for active contributors.
- Scope in this phase: development environment bootstrap, transport compatibility planning, and task tracking.
- Assumption: contributors have Git Bash and PowerShell 7+ available.
- Assumption: installers are fetched from official vendor endpoints (Node.js, Rust, Astral uv) and unpacked into repo-local deterministic directories.
- Assumption: this status file is the persistent source of truth for Windows porting progress.

## Completed Progress So Far

- Added `non-nix-build/windows/env.sh` to expose a Windows DIY environment with pinned tool variables and PATH wiring.
- Added `non-nix-build/windows/bootstrap-windows-diy.ps1` for idempotent tool bootstrap (Rust, Node.js, uv) with strict mode, retries, and checksum verification.
- Added pinned versions in `non-nix-build/windows/toolchain-versions.env`.
- Added Windows DIY bootstrap/install support for `ct-remote` (x64 artifact pin + SHA256 verification) and PATH wiring in `non-nix-build/windows/env.sh`.
- Added Windows DIY bootstrap/install support for Nim with source+prebuilt policy controls, deterministic source cache metadata, pinned prebuilt SHA256 verification, and `NIM1` wiring in `non-nix-build/windows/env.sh`.
- Added Windows DIY bootstrap/install support for Cap'n Proto with `CAPNP_WINDOWS_SOURCE_MODE=auto|source|prebuilt`, deterministic source-cache metadata reuse, pinned x64 prebuilt SHA256 verification, and pointer-based `CAPNP_DIR`/PATH wiring in `non-nix-build/windows/env.sh`.
- Added Windows DIY bootstrap/install support for Tup with `TUP_WINDOWS_SOURCE_MODE=auto|source|prebuilt`, source-first defaults pinned to `https://github.com/zah/tup.git` (`variants-for-windows`), deterministic source-cache metadata reuse under `.tools/windows-diy/tup/cache/source/<cache-key>/`, and pointer-based `TUP_DIR`/PATH wiring in `non-nix-build/windows/env.sh`.
- Added a documented version bump workflow and CI validation script for `non-nix-build/windows/toolchain-versions.env`.
- Added GitHub Actions Windows smoke coverage (`windows-bootstrap-smoke`) to validate Windows bootstrap script syntax/parsing and required toolchain version keys.
- Extended `windows-bootstrap-smoke` with deterministic arm64 mode-routing probes for `NIM_WINDOWS_SOURCE_MODE`, `CAPNP_WINDOWS_SOURCE_MODE`, and `CT_REMOTE_WINDOWS_SOURCE_MODE` using `WINDOWS_DIY_ARCH_OVERRIDE` plus skip flags, including assertions that block invalid x64 fallback/download regressions.
- Integrated Windows non-Nix bootstrap references into top-level docs (`README.md` and `AGENTS.md`).
- Added shared parser-generation guard `non-nix-build/ensure_tree_sitter_nim_parser.sh` and integrated it into both Unix and Windows non-Nix flows (`non-nix-build/build_db_backend.sh`, `non-nix-build/setup_node_deps.sh`, and `non-nix-build/windows/env.sh`).
- Added `ct-remote` local-source support in Windows bootstrap via `CT_REMOTE_WINDOWS_SOURCE_MODE=auto|local|download` and `CT_REMOTE_WINDOWS_SOURCE_REPO`, with pinned-download fallback retained for x64.
- Updated `ct-remote` mode routing so Windows arm64 can run local-source mode in `auto` without attempting pinned x64 download fallback; `download` mode remains explicitly x64-only, and `CT_REMOTE_WINDOWS_SOURCE_RID` now defaults by architecture (`win-x64` on x64, `win-arm64` on arm64) while remaining overrideable.
- Added `NIM_WINDOWS_SOURCE_MODE=auto|source|prebuilt` with deterministic source cache keying under `.tools/windows-diy/nim/<version>/cache/source/<cache-key>/`, metadata-driven reuse checks (`nim.source.meta` + `nim.install.meta`), and pinned prebuilt fallback for `auto`.
- Updated Nim mode-selection policy so `NIM_WINDOWS_SOURCE_MODE=source` can run on Windows arm64 and `auto` on arm64 fails after source attempt without x64 prebuilt fallback; prebuilt mode remains explicitly x64-only.
- Validated Windows arm64-machine Nim source mode end-to-end (`NIM_WINDOWS_SOURCE_MODE=source`) with deterministic source-cache install and reuse at `.tools/windows-diy-arm64-nim-test`: first run built from source and installed cache key `459e014133e34d5816992af547016e773a71d1df02d964b9ea20ddd2483b0e19`; second run logged explicit `source cache hit` for that key.
- Fixed two bootstrap runtime issues surfaced by smoke runs: `Download-String` now normalizes byte/object-array checksum payloads before SHA parsing, and uv release URLs now use `releases/download/<version>/...` (no `v` prefix).
- Updated sub-agent guidance to call out sandbox/approval mismatch recovery for writable runs.
- Completed DAP transport Phase-1 groundwork: added cross-platform endpoint abstraction/helpers and refactored current Unix socket-path derivation to use shared endpoint naming helpers (no Unix runtime behavior change).
- Completed DAP transport Phase-2 startup split in `src/db-backend/src/dap_server.rs`: transport establishment now routes through endpoint/stream entry points (`run_with_endpoint`, `run_with_stream`) while preserving existing Unix socket and `--stdio` behavior.
- Completed DAP transport Phase-3 connector step in `src/db-backend/src/dap_server.rs` and `src/db-backend/crates/db-backend-core/src/dap_server.rs`: Windows now connects to `\\.\pipe\ct_dap_socket_<pid>` endpoints with explicit wait/open logic (`WaitNamedPipeW` + handle open), while Unix keeps `UnixStream` behavior unchanged.
- Completed DAP test transport gating for `src/db-backend/tests/test_harness/mod.rs` and `src/db-backend/tests/dap_backend_server.rs`: Unix-domain-socket paths are now `cfg(unix)`-gated and non-Unix builds report explicit unsupported/skip messaging.
- Completed Windows listener/accept transport in `src/tui/src/dap_client.rs`: Unix behavior remains unchanged, while Windows now creates `\\.\pipe\ct_dap_socket_<pid>` first, spawns backend with that endpoint arg, then accepts the backend connection over named pipes for the existing DAP framing flow.
- Added Windows-only executable transport tests in `src/tui/src/dap_client.rs` that validate endpoint naming, listener creation, and named-pipe accept/connect handshake.
- Added Windows named-pipe integration coverage in `src/tui/src/dap_client.rs` for `DapClient::start(...)` + `initialize()` + `launch(...)` including initialized-event-triggered `configurationDone` request flow, using an executable mock backend process.
- Added Windows-only error/multi-client transport checks in `src/tui/src/dap_client.rs`: backend spawn failure propagation, listener accept timeout without a connecting client, and deterministic second-client rejection while a single pipe instance is already active.
- Added Windows reconnect coverage in `src/tui/src/dap_client.rs`: `DapClient::start(...)` + initialize/launch handshake succeeds across two back-to-back full session teardowns in the same process, reusing the PID-based endpoint naming pattern.
- Added GitHub Actions Windows coverage for named-pipe transport tests via `windows-named-pipe-tests` in `.github/workflows/codetracer.yml`, running `cargo test --bin simple-tui windows_named_pipe -- --nocapture` in `src/tui`.
- Added focused stdio fallback coverage in `src/db-backend/tests/dap_backend_stdio.rs`: `dap_server_stdio_initialize_handshake_works` launches `db-backend dap-server --stdio` and validates a minimal DAP exchange (`initialize` response + `initialized` event).
- Extended stdio fallback coverage in `src/db-backend/tests/dap_backend_stdio.rs`: `dap_server_stdio_disconnect_acknowledges_and_exits` now validates a deterministic `disconnect` request/response path and asserts the backend process terminates after acknowledging `disconnect`.
- 2026-02-09 (Step 5 validation): verified `capnp` from bootstrap install on PATH (`Cap'n Proto version 1.3.0`) and regenerated `libs/tree-sitter-nim/src/parser.c` using an isolated `tree-sitter-cli` install to avoid arm64 `node-gyp` addon build failures in `npm ci`.
- 2026-02-09 (Step 6 validation): replaced `expanduser v1.2.2` with `shellexpand v3.1.1` in `src/db-backend` (`io-transport` feature + `trace_processor` path expansion helper), removing the Windows arm64 transitive `pwd::Passwd` compile failure.
- 2026-02-09 (Step 6 validation): reran `cargo build`, `cargo test`, and `cargo clippy` in `src/db-backend` with Windows DIY toolchain env and isolated project-level Windows compile blockers (`UnixStream` cfg-gating in `src/core.rs`/`src/rr_dispatcher.rs`, plus `CreateFileW` symbol coupling in `src/dap_server.rs`).
- 2026-02-09 (Step 7 validation): fixed those Windows compile blockers by cfg-gating Unix-only stream types in `src/core.rs` and `src/rr_dispatcher.rs` (with explicit non-Unix runtime errors for unsupported rr/core socket transports), switching `src/db-backend/src/dap_server.rs` Windows client connect to `WaitNamedPipeW` + `std::fs::OpenOptions`, and making `src/db-backend/src/main.rs` symlink creation platform-aware (`symlink` on Unix, `symlink_dir` on Windows).
- 2026-02-09 (Step 7 validation): reran `cargo build`, `cargo test`, and `cargo clippy` in `src/db-backend` with `CAPNP_DIR=.tools/windows-diy/capnp/1.3.0/cache/source/274ee662fc8ba6332580d44c2adae6dc4b36b783c761d1e4fe43c389f50597b7/install` and `PATH=$CAPNP_DIR/bin;$PATH`; `cargo build` and `cargo clippy` pass on Windows arm64, while `cargo test` has one remaining failure in `tests/dap_backend_stdio.rs` (`dap_server_stdio_disconnect_acknowledges_and_exits`: `JSON error: Missing Content-Length header`).
- 2026-02-09 (Step 8 validation): fixed `src/db-backend/src/dap_server.rs` disconnect shutdown sequencing for stdio transport by removing immediate `process::exit(0)` in the request handler and waiting for the sending thread to confirm the framed `disconnect` response is written before terminating the server loop.
- 2026-02-09 (Step 8 validation): reran `cargo test --test dap_backend_stdio dap_server_stdio_disconnect_acknowledges_and_exits -- --nocapture`, full `cargo test`, `cargo build`, and `cargo clippy` in `src/db-backend`; all pass on this Windows arm64 host.
- 2026-02-09 (Step 9 validation): added `../codetracer-ci/non-nix-build/windows` repo-local dotnet bootstrap (`bootstrap-windows-dotnet.ps1`, `env.ps1`, `env.sh`, `validate-dotnet-bootstrap.ps1`) pinned by `../codetracer-ci/global.json`; on this Windows arm64 host, exact `9.0.0` was unavailable and bootstrap correctly used `rollForward=latestFeature` to install `9.0.310`.
- 2026-02-09 (Step 9 validation): attempted `dotnet publish apps/DesktopClient/DesktopClient.App/DesktopClient.App.csproj -r win-x64` and `-r win-arm64` in `../codetracer-ci`; both currently fail for native AOT linker/toolchain reasons (`win-x64`: missing Visual C++ linker prerequisites, `win-arm64`: `/usr/bin/link` from Git toolchain selected), but the prior ct-remote bootstrap blocker (`dotnet` missing) is now removed via repo-local bootstrap.
- 2026-02-09 (Step 10 delivery): added `../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1` so local Windows DesktopClient publishes run through the repo-local dotnet env/bootstrap path with `PublishAot=false` by default and opt-in `-EnableAot` for fully provisioned native-AOT machines.
- 2026-02-09 (Step 10 validation): executed `pwsh -File ../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1 -Rid win-x64` and `pwsh -File ../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1 -Rid win-arm64`; both succeeded in default non-AOT mode on this host.
- 2026-02-09 (Step 11 delivery): updated `non-nix-build/windows/bootstrap-windows-diy.ps1` ct-remote local-source mode to prefer `../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1` (or `CT_REMOTE_WINDOWS_PUBLISH_SCRIPT` override), preserving existing `auto|local|download` semantics, arch-aware RID defaults, and x64 pinned-download fallback behavior.
- 2026-02-09 (Step 11 delivery): hardened `non-nix-build/ensure_tree_sitter_nim_parser.sh` CLI selection: local CLI first, lockfile `npm ci` path when available, then isolated `tree-sitter-cli` fallback under `.tools/tree-sitter-cli-cache` to avoid Windows arm64 Node 24 native-addon build failures when only parser generation is required.
- 2026-02-09 (Step 12 end-state verification): full default `pwsh -File non-nix-build/windows/bootstrap-windows-diy.ps1` now succeeds on this Windows arm64 host with no skip flags, including local-source `ct-remote` publish via `../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1` and default `CT_REMOTE_WINDOWS_SOURCE_RID=win-arm64`.
- 2026-02-09 (Step 12 consistency fix): aligned `non-nix-build/windows/env.sh` with bootstrap/docs by making the default `CT_REMOTE_WINDOWS_SOURCE_RID` architecture-aware (`win-x64` on x64, `win-arm64` on arm64) while preserving explicit overrides.
- 2026-02-09 (Step 12 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser/syntax checks (`*.ps1`, `non-nix-build/windows/env.sh`, `non-nix-build/ensure_tree_sitter_nim_parser.sh`), `cargo build/test/clippy` in `src/db-backend`, and `cargo test --bin simple-tui windows_named_pipe -- --nocapture` in `src/tui`; all passed on this host.
- 2026-02-09 (Step 13 delivery): integrated Tup into Windows non-Nix bootstrap/env/version pins with `TUP_SOURCE_*` pins, `TUP_WINDOWS_SOURCE_MODE=auto|source|prebuilt`, deterministic source cache metadata (`tup.source.meta`) and selected-install metadata (`tup.install.meta`), plus optional explicit prebuilt fallback (`TUP_WINDOWS_PREBUILT_URL` + `TUP_WINDOWS_PREBUILT_SHA256`).
- 2026-02-09 (Step 13 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, PowerShell parser checks for `bootstrap-windows-diy.ps1`, and `bash -n non-nix-build/windows/env.sh`; all passed.
- 2026-02-09 (Step 13 practical probe): on this Windows arm64 host, Tup source bootstrap from pinned fork/ref reaches clone+checkout but fails at build prerequisites (`pkg-config`/`gcc` missing in Git Bash path), and explicit upstream prebuilt probe (`https://gittup.org/tup/win32/tup-latest.zip`) fails to execute (`tup.exe --version` exit `-1073741515`, missing runtime dependency), so end-to-end `tup --version` success is currently blocked by host toolchain/runtime prerequisites.
- 2026-02-09 (Step 14 delivery): extended Tup source bootstrap to provision a pinned repo-local MSYS2 prerequisite root (`msys2-base-x86_64-20251213.tar.xz`, SHA256 pinned) under `.tools/windows-diy/tup/msys2/<version>/msys64`, install pinned prerequisite packages, and run Tup source build inside that shell with an explicit `pkg-config` shim for the `fuse` probe.
- 2026-02-09 (Step 14 practical probe): with MSYS2 prerequisites provisioned, Tup source bootstrap now advances past missing-tool errors and fails at source compile compatibility (`src/tup/platform.c` reports unsupported platform in current `bootstrap.sh`/`build.sh` path), providing a reproducible upstream blocker after prerequisite provisioning.
- 2026-02-09 (Step 14b regression fix): `Ensure-TupMsys2BuildPrereqs` now routes native command stdout to `Out-Host` so function pipeline output stays a single hashtable; this removes the `Ensure-TupFromSource` failure `The property 'bashExe' cannot be found on this object`.
- 2026-02-09 (Step 14b practical probe): Tup-only bootstrap (`WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1`, `TUP_WINDOWS_SOURCE_MODE=source`) now proceeds past MSYS2 prereq object handling and fails later inside Tup source bootstrap (`Package 'fuse' not found` followed by `Tup source bootstrap command failed: ./bootstrap.sh ...`), confirming the previous hashtable/pipeline regression is resolved.
- 2026-02-09 (Step 15 delivery): updated the Tup bootstrap `pkg-config` shim in `non-nix-build/windows/bootstrap-windows-diy.ps1` to bypass `fuse` lookups regardless of argument order by scanning all argv tokens (instead of checking only `$1`).
- 2026-02-09 (Step 15 practical probe): reran the required Tup-only bootstrap command with `TUP_WINDOWS_SOURCE_MODE=source`; this run progressed through source mode setup but failed during `git clone` of `https://github.com/zah/tup.git` with transient upstream transport errors (`HTTP 500`, `fatal: expected 'packfile'`) before the bootstrap reached the `pkg-config` fuse probe stage.
- 2026-02-09 (Step 16 delivery): switched Tup Windows source defaults to MinGW-targeted bootstrap values (`TUP_SOURCE_BUILD_COMMAND=TUP_MINGW=1 TUP_MINGW32=0 ./bootstrap.sh`, `TUP_MSYS2_PACKAGES=mingw-w64-x86_64-gcc mingw-w64-x86_64-pkgconf make`) and updated the source bootstrap shell wrapper to prepend `mingw64/bin` and `mingw32/bin` before `usr/bin`.
- 2026-02-09 (Step 16 practical probe): reran Tup-only bootstrap (`WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1`, `TUP_WINDOWS_SOURCE_MODE=source`) against `.tmp/windows-diy-step16`; source build advanced past prior `src/tup/platform.c` unsupported-platform diagnostics and now fails later in MinGW compilation with `implicit declaration` errors for `lstat` and `fchdir` in `src/tup/create_name_file.c`.
- 2026-02-09 (Step 17 delivery): added a codetracer-owned Windows Tup bootstrap path in `non-nix-build/windows/bootstrap-windows-diy.ps1` that, when `TUP_WINDOWS_SOURCE_BUILD_COMMAND` is left at the pinned default, generates `codetracer-bootstrap-windows.sh` in the Tup source checkout and runs it in MSYS2 MinGW mode instead of upstream `bootstrap.sh`.
- 2026-02-09 (Step 17 delivery): the generated script now compiles Lua + Tup directly with MinGW (including `src/compat/win32` and `src/tup/server/windepfile.c`), produces `build/tup.exe`, runs `build/tup.exe init` when `.tup` is missing, then runs `build/tup.exe upd`; source-cache metadata now includes `tup_source_effective_build_command` identity for deterministic cache keying.
- 2026-02-09 (Step 17 validation): required validation commands were rerun: `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, PowerShell parser check for `bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step17` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`.
- 2026-02-09 (Step 17 practical probe): Tup source bootstrap now reaches the codetracer script path and progresses through substantially more MinGW compilation, but currently fails at `src/compat/fstatat.c` with MinGW type-signature incompatibility: `_stat64` expects `struct _stat64*` while code passes `struct stat*`.
- 2026-02-09 (Step 18 delivery): added a transient Tup source-prepare patch in `non-nix-build/windows/bootstrap-windows-diy.ps1` (`Apply-TupWindowsSourcePatches`) that rewrites `src/compat/fstatat.c` `_stat64(pathname, buf)` callsites to `stat(pathname, buf)` inside the staged source checkout only; no persistent upstream/fork edits are made.
- 2026-02-09 (Step 18 delivery): bumped generated default Tup script identity to `codetracer-bootstrap-windows.sh@v6` so `tup_source_effective_build_command` cache-key metadata reflects the new transient patch behavior.
- 2026-02-09 (Step 18 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step18` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; `fstatat.c` mismatch is resolved, and the next compile blocker is now `src/compat/win32/lstat.c` (`_wstat64` expects `struct _stat64*` while code passes `struct stat*`).
- 2026-02-09 (Step 19 delivery): extended `Apply-TupWindowsSourcePatches` in `non-nix-build/windows/bootstrap-windows-diy.ps1` to also patch staged `src/compat/win32/lstat.c`, rewriting `_wstat64(wpathname, buf)` to `_wstat(wpathname, buf)` with explicit guard rails (missing file throws, zero matches logs/no-ops, unchanged replacement throws).
- 2026-02-09 (Step 19 delivery): bumped generated default Tup script identity to `codetracer-bootstrap-windows.sh@v7` so `tup_source_effective_build_command` cache-key metadata invalidates for the new staged-source patch behavior.
- 2026-02-09 (Step 19 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step19` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; prior `_wstat64` callsite is patched and build advances, but MinGW still fails in `src/compat/win32/lstat.c` because `_wstat` resolves to `_wstat64i32` which expects `struct _stat64i32*` while code still passes `struct stat*`.
- 2026-02-09 (Step 20 delivery): updated `Apply-TupWindowsSourcePatches` in `non-nix-build/windows/bootstrap-windows-diy.ps1` to patch staged `src/compat/win32/lstat.c` to `stat(pathname, buf)` directly, handling both `_wstat64(wpathname, buf)` and `_wstat(wpathname, buf)` callsites with explicit guard/log/throw behavior.
- 2026-02-09 (Step 20 delivery): bumped generated default Tup script identity to `codetracer-bootstrap-windows.sh@v8` so `tup_source_effective_build_command` cache-key metadata invalidates for the revised staged-source patch logic.
- 2026-02-09 (Step 20 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step20` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; the prior `lstat.c` struct mismatch no longer appears, and the next blocker is link-stage `multiple definition of 'main'` (`src_lua_luac.o:luac.c` vs `src_tup_tup_main.o:main.c`).
- 2026-02-09 (Step 21 delivery): updated generated Tup bootstrap logic in `non-nix-build/windows/bootstrap-windows-diy.ps1` so `tup_lua_objects` excludes both `src_lua_lua.o` and `src_lua_luac.o`, preventing the `luac` main object from being linked into `tup.exe` while preserving Lua helper binary generation via `lua_link_objects`.
- 2026-02-09 (Step 21 delivery): bumped generated default Tup script identity to `codetracer-bootstrap-windows.sh@v9` so `tup_source_effective_build_command` cache-key metadata invalidates for the revised generated-script link behavior.
- 2026-02-09 (Step 21 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step21` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; prior link-stage `multiple definition of 'main'` no longer appears, and the next blocker is Tup parse/update failure (`Unable to find tup entry for file 'win32.tup'` from `include @(TUP_PLATFORM).tup` in `Tuprules.tup`).
- 2026-02-09 (Step 22 delivery): extended `Apply-TupWindowsSourcePatches` in `non-nix-build/windows/bootstrap-windows-diy.ps1` to synthesize a minimal deterministic root `win32.tup` include stub when missing, scoped only to the temporary Tup source checkout used by source-mode bootstrap.
- 2026-02-09 (Step 22 delivery): adjusted transient patch control flow so upstream no-op cases for `fstatat.c`/`lstat.c` no longer return early before the `win32.tup` presence check, and bumped generated-script identity to `codetracer-bootstrap-windows.sh@v10` for deterministic source-cache invalidation.
- 2026-02-09 (Step 22 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step22` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; prior `win32.tup` parse blocker is resolved, and the next blockers are Tup command-tracking/runtime failures in `src/tup/server/fuse_{server,fs}.c` (ephemeral `*-pipe-nt-*` outputs not declared in `.tup/db`) plus MinGW portability compile failures in `src/tup/flock/fcntl.c` (`openat`/`struct flock`/`fcntl` symbols unavailable).
- 2026-02-09 (Step 23 delivery): extended `Apply-TupWindowsSourcePatches` in `non-nix-build/windows/bootstrap-windows-diy.ps1` to patch staged Tupfiles for Windows source bootstrap: `src/tup/server/Tupfile` now rewrites `: foreach fuse_server.c fuse_fs.c master_fork.c |> !cc |>` to `: foreach master_fork.c |> !cc |>` (preserving `: windepfile.c |> !mingwcc |>`), `src/tup/flock/Tupfile` removes `: foreach fcntl.c |> !cc |>` (preserving `: foreach lock_file.c |> !mingwcc |>`), and root `Tupfile` removes `client_objs += src/tup/flock/fcntl.o` so archive inputs stay consistent.
- 2026-02-09 (Step 23 delivery): bumped generated-script/cache identity to `codetracer-bootstrap-windows.sh@v12` for deterministic source-cache invalidation of the new staged-source patch behavior.
- 2026-02-09 (Step 23 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step23` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; prior `fuse_{server,fs}.c` command-tracking/runtime and `flock/fcntl.c` portability blockers are cleared, and the next blocker is MinGW compile failure in `src/tup/server/master_fork.c` (`fatal error: sys/socket.h: No such file or directory`).
- 2026-02-09 (Step 24 delivery): updated `Apply-TupWindowsSourcePatches` in `non-nix-build/windows/bootstrap-windows-diy.ps1` so staged `src/tup/server/Tupfile` now removes the full fused `: foreach fuse_server.c fuse_fs.c master_fork.c |> !cc |>` rule (instead of rewriting it to `master_fork.c`), while keeping `: windepfile.c |> !mingwcc |>` intact and preserving existing explicit guard/log/throw semantics.
- 2026-02-09 (Step 24 delivery): bumped generated-script/cache identity to `codetracer-bootstrap-windows.sh@v13` for deterministic source-cache invalidation of the updated staged-source patch behavior.
- 2026-02-09 (Step 24 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, and Tup-only probe to `.tmp/windows-diy-step24` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`; prior `master_fork.c`/`sys/socket.h` failure is cleared, and the next blockers are Tup update/output-tracking mismatch in `src/lua` (`lua.exe` vs expected `lua`) plus MinGW compile portability failures in `src/tup/tup/main.c` (`flist.h` wide/ANSI type mismatch with `FindFirstFile`/`WideCharToMultiByte`, and missing `fchdir`/`symlink`/`lstat`/`S_ISLNK`).
- 2026-02-09 (Step 25 delivery): updated generated Tup bootstrap path in `non-nix-build/windows/bootstrap-windows-diy.ps1` so source bootstrap treats manually compiled `build/tup.exe` as the final artifact by default and skips self-host `build/tup.exe init` + `build/tup.exe upd`; added opt-in debug gate `TUP_WINDOWS_SELF_HOST_UPDATE=1|true|yes|on` to re-enable self-host update when needed.
- 2026-02-09 (Step 25 delivery): bumped generated-script/cache identity to `codetracer-bootstrap-windows.sh@v14` for deterministic source-cache invalidation of the new default behavior, and updated source install staging to copy `tup-dllinject.dll` alongside `tup.exe` so installed binary execution is self-contained.
- 2026-02-09 (Step 25 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, parser check for `non-nix-build/windows/bootstrap-windows-diy.ps1`, Tup-only probe to `.tmp/windows-diy-step25` with `WINDOWS_DIY_SKIP_{RUST,NODE,UV,NIM,CAPNP,CT_REMOTE}=1` + `TUP_WINDOWS_SOURCE_MODE=source`, and direct installed-binary check from `tup.install.relative-path`; probe now succeeds and installed `tup.exe --version` returns `tup codetracer-bootstrap` (exit 0).
- 2026-02-09 (Step 26 delivery): fixed Windows non-Nix env parsing/interop edge cases by updating `non-nix-build/windows/toolchain-versions.env` handling for multi-token quoted values, preferring `pwsh` (with `powershell.exe` fallback) in `non-nix-build/windows/env.sh`, and deriving `ROOT_DIR` in `non-nix-build/ensure_tree_sitter_nim_parser.sh` when unset so `set -u` does not fail during default parser-sync from `source non-nix-build/windows/env.sh`.
- 2026-02-09 (Step 26 validation): reran `bash -n non-nix-build/windows/env.sh`, `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, and practical `source non-nix-build/windows/env.sh; tup.exe --version`; all succeeded.
- 2026-02-10 (Step 31 delivery): switched Tup Windows default bootstrap to pinned official prebuilt (`https://gittup.org/tup/win32/tup-latest.zip` + repo-pinned SHA256) while preserving explicit source-mode support (`TUP_WINDOWS_SOURCE_MODE=source`) and existing source bootstrap path.
- 2026-02-10 (Step 31 delivery): fixed Tupfile command-rule issues in the staged Windows Tup flow by replacing `nim1` invocations with `nim` and rewriting cargo env assignment usage to `cargo --target-dir ...` form for Tup command parsing compatibility.
- 2026-02-10 (Step 31 validation): reran environment/toolchain validation, practical `tup --version` checks, and targeted Tup parse validation; all passed for the updated default prebuilt route.
- 2026-02-10 (Step 31 practical probe): targeted `tup upd build-debug/bin/tester build-debug/bin/small-lang` now surfaces current follow-up blockers: Rust link stage resolves the wrong `link.exe` in this shell context (`link: extra operand ...`), Nim compile path invokes missing `gcc.exe`, and Tup records many undeclared Nim cache writes under `C:/tmp/ct-nim-cache/...` after the failed command.
- 2026-02-10 (Step 33 delivery): added deterministic Windows Tup build controls: `src/config.nims` now forces Nim C backend to `vcc` on Windows, `src/Tuprules.tup` now passes Cargo windows-msvc linker config as `rust-lld` in-rule (instead of relying on daemon-propagated linker env), and Rust target copy steps now use Windows-compatible target-dir/copy paths.
- 2026-02-10 (Step 33 delivery): `non-nix-build/windows/export-msvc-env.ps1` now prepends MSVC tool include/lib paths (`.../VC/Tools/MSVC/<ver>/include` and `.../lib/<arch>`) when exporting `INCLUDE`, `LIB`, and `LIBPATH`, so Tup-driven Rust/Nim invocations get `msvcrt.lib` and standard headers deterministically.
- 2026-02-10 (Step 33 validation): reran `pwsh -File non-nix-build/windows/validate-toolchain-versions.ps1`, `bash -n non-nix-build/windows/env.sh`, `bash -lc '...; source non-nix-build/windows/env.sh; command -v tup.exe; tup.exe --version'`, and `bash -lc '...; source non-nix-build/windows/env.sh >/dev/null; cd src; tup parse; tup upd build-debug/bin/tester build-debug/bin/small-lang'`. The probe now gets past the prior `msvcrt.lib` and `gcc.exe` failures; remaining blockers are Tup output declaration/path issues (`bin/small-lang.exe` vs expected `bin/small-lang`) and a `tester` Nim command failure currently surfaced as Tup `Broken pipe`/output-file handling errors, with undeclared Nim cache writes still pending.
- 2026-02-10 (Step 34 delivery): fixed Windows Tup `small-lang` output mismatch by updating `src/Tuprules.tup` `!rust_cargo_small_lang` to stream the built binary with `cat ... > %o` (instead of `cp ... %o`), ensuring the declared extensionless Tup output `bin/small-lang` is the file that is actually written.
- 2026-02-10 (Step 34 delivery): fixed Windows Nim tester `pwd.h` failure at root cause in project code by gating `std/posix` usage in `src/common/paths.nim` to non-Windows and using `USERNAME` env fallback on Windows C builds.
- 2026-02-10 (Step 34 validation): reran the required four-command validation set; the first three commands pass, and in the fourth command the prior blockers are cleared (`small-lang` no longer trips Tup output mismatch, and `tester` no longer fails on `pwd.h`).
- 2026-02-10 (Step 35 delivery): updated Windows Tup rules to use built-in executable suffix handling (`EXE_SUFFIX` via `TUP_PLATFORM`) instead of ad-hoc copy fallbacks.
- 2026-02-10 (Step 35 delivery): added Tup ignore-output regexes for Nim and Cargo side outputs (`nimcache` and Cargo `target-dir`) so these writes do not break Tup output accounting.
- 2026-02-10 (Step 35 validation): using the pinned prebuilt Tup binary, `tup parse` succeeds and `tup upd build-debug/bin/small-lang.exe` succeeds; a follow-up `tester.exe` failure in one run was traced to invocation shell context, not toolchain pinning.
- 2026-02-10 (Step 36 delivery): corrected Tup ignore-output handling in `src/Tuprules.tup` to use documented `extra outputs` form (`| ^regex`) with cross-platform path-separator regexes for Nim cache and Cargo target dirs.
- 2026-02-10 (Step 36 validation): from an initialized shell (`source non-nix-build/windows/env.sh`), `which nim` resolves to the pinned repo-local Nim, `tup parse` succeeds, and `tup upd build-debug/bin/tester.exe` now succeeds without undeclared `C:/tmp/ct-nim-cache/...` output errors.
- 2026-02-10 (Step 37 delivery): fixed Windows Nim/Tup blockers for `ct` compile by switching `src/ct/ct_wrapper.nim` signal forwarding to `terminate(ctProcess)` on Windows and keeping POSIX `kill` path on Unix, and by adding Nim-version-aware SQLite imports in `src/common/trace_index.nim` (`../db_connector/db_sqlite` on Nim 2+, `impure/db_sqlite` on older Nim) with vendored Nim 2 connector sources under `src/db_connector/`.
- 2026-02-10 (Step 37 validation): in `src/build-debug` with `source ../../non-nix-build/windows/env.sh`, `tup upd` no longer fails on `cannot open file: std/db_sqlite` or Windows `kill/SIGTERM` compile errors.
- 2026-02-10 (Step 38 delivery): fixed remaining frontend Nim 2 portability blockers across `src/frontend/*` (capture safety in `nimcall` handlers, enum/int strictness in menu macros, `jsre` API mismatch, and value-path recursion captures).
- 2026-02-10 (Step 38 validation): in `src/build-debug` with initialized Windows env, targeted variant frontend outputs build successfully: `tup upd ui.js index.js subwindow.js server_index.js tests/ipc_registry_test.js tests/reload_reconnect.js tests/reload_bootstrap_host.js`.
- 2026-02-10 (Step 39 delivery): fixed remaining full-graph Windows variant blockers by (1) linking bundled libzip against zlib on Windows (`libs/zip/zip/libzip.nim`), (2) avoiding shared Nim cache collisions in `!codetracer` (`src/Tuprules.tup`), (3) ignoring Nim-generated side outputs (`*_linkerArgs.txt`) in Tup output accounting, and (4) cfg-gating POSIX-only signal handling in CT launcher modules (`src/ct/launch/backends.nim`, `src/ct/launch/cleanup.nim`).
- 2026-02-10 (Step 39 validation): full variant build now succeeds from initialized env: `cd src/build-debug && source ../../non-nix-build/windows/env.sh && tup upd` (exit 0).
- 2026-02-10 (Step 40 delivery): extended `.github/workflows/codetracer.yml` `windows-bootstrap-smoke` with two practical Windows non-Nix probes: (1) shell-wiring probe `source non-nix-build/windows/env.sh; tup.exe --version`, and (2) targeted validation probe `source non-nix-build/windows/env.sh; command -v nim; tup upd build-debug/bin/tester.exe` (with defensive `tup init` if `.tup` is absent).
- 2026-02-10 (Step 40 validation): local workflow syntax check passes after probe additions (`ruby -e "require 'yaml'; YAML.load_file('.github/workflows/codetracer.yml'); puts 'YAML_OK'"`), and probe commands are captured verbatim in CI job steps with fail-fast shell flags (`set -euo pipefail`) plus non-essential bootstrap skips for speed/stability on `windows-latest`.
- 2026-02-10 (Step 41 practical probe): revalidated ct-remote artifact availability at `CT_REMOTE_VERSION=102d2c8`; `DesktopClient.App-win-x64-102d2c8.tar.gz` is HTTP 200 while `win-arm64`, `win-aarch64`, and `win-arm64ec` variants are still HTTP 404, so pinned arm64 download mode remains externally blocked.

## Outstanding Tasks

- [x] Add a targeted Windows validation probe that runs `source non-nix-build/windows/env.sh; command -v nim; tup upd build-debug/bin/tester.exe` and fails on any undeclared-output regression.
- [x] Add a Windows CI smoke probe that verifies practical shell wiring (`source non-nix-build/windows/env.sh; tup.exe --version`) in addition to syntax/validator checks.
- [x] Add integration tests that validate Windows transport behavior under reconnect and multi-client scenarios.
- [x] Ensure default Windows DIY bootstrap succeeds on this arm64 host without skip flags.

## Deferred Tasks

- [ ] Keep pinned Windows arm64 `ct-remote` download coverage deferred for now; local-source bootstrap from `../codetracer-ci` is the preferred development path.

## Blockers and Risks

- External distribution blocker: arm64 `ct-remote` download artifacts are still unavailable at pinned revision `102d2c8` (`win-arm64`, `win-aarch64`, `win-arm64ec` probes are HTTP 404 while `win-x64` is HTTP 200), so pinned arm64 download mode cannot be enabled yet.
- External checksum/publication risk: `downloads.codetracer.com` and `capnproto.org` do not publish sidecar SHA256 files for the pinned Windows artifacts, so repository-managed SHA pins remain required for those assets.
- External upstream format risk: bootstrap depends on vendor release/checksum URL structures; upstream format changes can break bootstrap until pins/parsers are updated.
- Shell consistency risk: Windows Tup validation must continue to run from the initialized non-Nix env (`source non-nix-build/windows/env.sh`) so toolchain and PATH assumptions match contributor workflows.

## Decision Log

- 2026-02-08: Created dedicated `non-nix-build/windows/` bootstrap path to keep Windows logic isolated from existing POSIX scripts while preserving reuse.
- 2026-02-08: Chosen deterministic install root `.tools/windows-diy` under repo to avoid user-global mutation and keep builds reproducible.
- 2026-02-08: Chosen Rust + Node.js + uv as initial bootstrap coverage because they unlock Rust backend work and Node-based frontend/tooling workflows.
- 2026-02-10: Switched Windows Tup default bootstrap from source-first to pinned official prebuilt (`tup-latest.zip` + SHA256 pin) while keeping explicit source mode available for fork/portability work.
- 2026-02-10: Switched Tup Windows build rules to platform-native executable suffix handling (`EXE_SUFFIX` from `TUP_PLATFORM`) and added ignore-output regexes for Nim/Cargo side-output directories.
- 2026-02-09: Added DAP transport migration ADR and milestone checklist (`docs/windows-dap-transport-adr.md`, `docs/windows-dap-transport-checklist.md`) to start implementation from a file-scoped design.
- 2026-02-09: Completed DAP transport Phase-1 endpoint groundwork in `db-backend` with transport endpoint helpers and Unix socket-path refactor using shared naming helpers, intentionally leaving Windows runtime connect/listen hookup as a later phase.
- 2026-02-09: Completed DAP transport Phase-2 db-backend startup refactor to separate transport setup from protocol handling via stream-oriented entry points; Windows named-pipe runtime path remains explicitly unimplemented and now fails with a clear error when selected.
- 2026-02-09: Completed DAP transport Phase-3 connector implementation in Rust db-backend path; `WindowsNamedPipe` now performs real named-pipe connect with explicit Windows API error reporting and no stdio fallback.
- 2026-02-09: Added `non-nix-build/windows/README.md` version bump instructions and `non-nix-build/windows/validate-toolchain-versions.ps1`, and wired the validator into `windows-bootstrap-smoke`.
- 2026-02-09: Completed platform-gating for db-backend DAP integration tests so Unix socket code compiles only on Unix and non-Unix runs emit explicit unsupported/skip messages.
- 2026-02-09: Implemented Windows named-pipe listener/accept in `src/tui/src/dap_client.rs` using `CreateNamedPipeW` + `ConnectNamedPipe`, preserving Unix startup behavior and endpoint naming (`\\.\pipe\ct_dap_socket_<pid>`).
- 2026-02-09: Added Windows transport error-path and single-instance tests in `src/tui/src/dap_client.rs` for startup spawn failure, accept timeout with no client, and second-client rejection while one client is connected.
- 2026-02-09: Added Windows reconnect-session coverage in `src/tui/src/dap_client.rs` by running two complete `DapClient::start` + initialize/launch sessions back-to-back in one process, confirming clean teardown allows reuse of the PID-scoped named-pipe endpoint pattern.
- 2026-02-09: Added a focused stdio DAP integration test in `src/db-backend/tests/dap_backend_stdio.rs` that starts the real backend in `dap-server --stdio` mode and asserts initialize handshake framing remains intact.
- 2026-02-09: Extended `src/db-backend/tests/dap_backend_stdio.rs` with a deterministic stdio disconnect-path test that validates `disconnect` response framing and backend termination after disconnect acknowledgement.
- 2026-02-09: Expanded `.github/workflows/codetracer.yml` `windows-bootstrap-smoke` with fast-fail arm64 routing probes that validate source-first `auto` routing for Nim/Cap'n Proto/ct-remote and explicitly forbid accidental x64 prebuilt/download fallback on arm64.
- 2026-02-09: Extended the Windows DIY toolchain flow to install Nim from official `nim-lang.org` release assets (`nim-<version>_x64.zip`) with pinned SHA256 + sidecar validation, and wired `NIM1`/PATH in `non-nix-build/windows/env.sh`; architecture support remains explicit x64-only until a pinned arm64 asset/hash is available.
- 2026-02-09: Added Windows Nim source bootstrap with deterministic cache keying/metadata reuse in `non-nix-build/windows/bootstrap-windows-diy.ps1` (`NIM_WINDOWS_SOURCE_MODE=auto|source|prebuilt`), while retaining pinned prebuilt ZIP fallback and writing selected install metadata to `nim.install.meta`.
- 2026-02-09: Refined Windows Nim mode selection so arm64 can attempt source bootstrap (`NIM_WINDOWS_SOURCE_MODE=source`), `auto` on arm64 fails clearly after source failure without prebuilt fallback, and `prebuilt` remains explicitly x64-only.
- 2026-02-09: Hardened arm64-machine Nim source bootstrap in `non-nix-build/windows/bootstrap-windows-diy.ps1` to handle upstream `csources_v3` layout/compiler realities (fallback bootstrap compiler source, VS Build Tools compiler/env discovery, VC include/lib hydration, `vccexe.exe` carry-forward, deterministic cache directory copy), and confirmed rerun cache-hit behavior for cache key `459e014133e34d5816992af547016e773a71d1df02d964b9ea20ddd2483b0e19`.
- 2026-02-09: Probed candidate arm64 ct-remote URLs for pinned revision `102d2c8` at `downloads.codetracer.com`; all arm64 naming variants returned HTTP 404 while x64 returned HTTP 200, so bootstrap remains intentionally x64-only pending official arm64 artifact and hash input.
- 2026-02-09: Added a standalone `windows-named-pipe-tests` CI job on `windows-latest` in `.github/workflows/codetracer.yml` to run focused `src/tui` transport coverage (`cargo test --bin simple-tui windows_named_pipe -- --nocapture`).
- 2026-02-09: Added Cap'n Proto pinning to Windows DIY bootstrap (`CAPNP_VERSION=1.3.0`, repo-pinned `CAPNP_WIN_X64_SHA256`) with toolchain validation, env wiring (`CAPNP_DIR`), and docs updates; checksum pinning is repo-managed because upstream does not publish a sidecar checksum for the Windows ZIP.
- 2026-02-09: Added Cap'n Proto source-mode bootstrap for Windows (`CAPNP_WINDOWS_SOURCE_MODE=auto|source|prebuilt`) with deterministic cache keying under `.tools/windows-diy/capnp/<version>/cache/source/<cache-key>/`, metadata-driven reuse checks (`capnp.source.meta` + `capnp.install.meta`), and arm64/non-x64 routing through source mode while keeping pinned x64 prebuilt flow.
- 2026-02-09: Added Tup source-first bootstrap for Windows (`TUP_WINDOWS_SOURCE_MODE=auto|source|prebuilt`) with default fork/ref pins (`TUP_SOURCE_REPO=https://github.com/zah/tup.git`, `TUP_SOURCE_REF=variants-for-windows`), deterministic source-cache metadata under `.tools/windows-diy/tup/cache/source/<cache-key>/`, selected-install metadata pointers, and explicit prebuilt fallback only when URL+SHA are provided.
- 2026-02-09: Added pinned MSYS2 prerequisite provisioning for Tup source bootstrap (`TUP_MSYS2_BASE_VERSION`, `TUP_MSYS2_BASE_X64_SHA256`, `TUP_MSYS2_PACKAGES`) and routed source builds through the repo-local MSYS2 shell with a deterministic `pkg-config` shim for missing `fuse` metadata, yielding reproducible compile-stage diagnostics on this host class.
- 2026-02-09: Updated Tup source defaults to MinGW-targeted bootstrap mode (`TUP_SOURCE_BUILD_COMMAND=TUP_MINGW=1 TUP_MINGW32=0 ./bootstrap.sh`) and MinGW MSYS2 package pins (`mingw-w64-x86_64-gcc`, `mingw-w64-x86_64-pkgconf`, `make`), and prepended MinGW bin directories ahead of `usr/bin` during source bootstrap execution.
- 2026-02-09: Fixed Tup MSYS2 prereq return-shape regression by preventing native command stdout from escaping `Ensure-TupMsys2BuildPrereqs`; `Ensure-TupFromSource` now receives a clean hashtable (`root`, `bashExe`, `metadata`) instead of mixed pipeline arrays.
- 2026-02-09: Consolidated tree-sitter-nim parser generation into shared `non-nix-build/ensure_tree_sitter_nim_parser.sh` and reused it in both Unix and Windows non-Nix entrypoints to keep parser generation deterministic and DRY.
- 2026-02-09: Added Windows bootstrap `ct-remote` source policy controls (`CT_REMOTE_WINDOWS_SOURCE_MODE`, `CT_REMOTE_WINDOWS_SOURCE_REPO`, `CT_REMOTE_WINDOWS_SOURCE_RID`) with `auto` preferring local `../codetracer-ci` publish output and falling back to pinned download when unavailable.
- 2026-02-09: Updated `ct-remote` route selection so arm64 `auto` uses local-source mode (no x64 pinned fallback), `download` mode is explicitly x64-only, and default source RID is architecture-aware (`win-x64`/`win-arm64`) with `CT_REMOTE_WINDOWS_SOURCE_RID` override preserved.
- 2026-02-09: Fixed two Windows bootstrap runtime issues from smoke runs: normalized `Download-String` handling for `Invoke-WebRequest` binary checksum payloads, and corrected uv asset URL tagging to `releases/download/<version>/...` for pinned `UV_VERSION`.
- 2026-02-09: Ran Step-5 db-backend Windows arm64 validation end-to-end: confirmed expected full-bootstrap `ct-remote` failure without `dotnet`, unblocked via `WINDOWS_DIY_SKIP_CT_REMOTE=1`, verified `capnp` path/version, regenerated `libs/tree-sitter-nim/src/parser.c` through CLI-only workaround, and captured db-backend compile blocker in `expanduser v1.2.2` (`pwd::Passwd` import failure).
- 2026-02-09: Ran Step-6 db-backend dependency fix validation: replaced `expanduser` with `shellexpand`, removed transitive `pwd` lockfile entries, and confirmed `cargo build`/`cargo test`/`cargo clippy` now progress past dependency compilation before failing on unrelated Windows project portability issues (`UnixStream` cfg-gating and `CreateFileW` symbol mismatch).
- 2026-02-09: Ran Step-7 db-backend Windows compile-fix validation: cfg-gated Unix-only stream usage in `src/core.rs` and `src/rr_dispatcher.rs`, updated Windows named-pipe connect in `src/dap_server.rs` to `WaitNamedPipeW` + `OpenOptions`, and made `src/main.rs` symlink creation platform-aware.
- 2026-02-09: Ran Step-8 db-backend stdio disconnect validation: fixed disconnect response/exit ordering in `src/dap_server.rs` so the framed `disconnect` response is guaranteed to flush before shutdown, and verified `cargo test` (including `tests/dap_backend_stdio.rs`), `cargo build`, and `cargo clippy` all pass on Windows arm64.
- 2026-02-09: Added `../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1` and documentation (`../codetracer-ci/non-nix-build/windows/README.md`, `../codetracer-ci/README.md`) for repeatable local Windows DesktopClient publish using repo-local dotnet, defaulting to non-AOT with optional `-EnableAot`.
- 2026-02-09: Updated local ct-remote bootstrap in `non-nix-build/windows/bootstrap-windows-diy.ps1` to invoke `../codetracer-ci/non-nix-build/windows/publish-desktop-client.ps1` by default when available, with `CT_REMOTE_WINDOWS_PUBLISH_SCRIPT` override and direct `dotnet publish` fallback only when helper script is missing.
- 2026-02-09: Hardened `non-nix-build/ensure_tree_sitter_nim_parser.sh` with deterministic isolated `tree-sitter-cli` fallback so parser generation no longer depends on installing/building `tree-sitter` native addon dependencies from the grammar package on Windows arm64 + Node 24.

## Immediate Next Steps

1. Run the updated `windows-bootstrap-smoke` workflow in CI and confirm the new practical probes stay green on `windows-latest` over several runs.
2. Add one focused Windows CI gate that runs full variant build from initialized env (`cd src/build-debug; source ../../non-nix-build/windows/env.sh; tup upd`) to lock in the recent Step-39 success path.
3. Keep the `ct-remote` arm64 download pinning item deferred unless release engineering starts publishing stable arm64 artifacts with checksums.
