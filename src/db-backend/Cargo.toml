[package]
name = "db-backend-core"
version = "0.1.0"
edition = "2021"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[build-dependencies]
cc="*"

# [patch.crates-io]
#
# tree-sitter = { git = "https://github.com/tree-sitter/tree-sitter", rev = "24c8feba3ea2e0e054de3f64333e554ca9353e38" }
# tree-sitter-rust = { git = "https://github.com/tree-sitter/tree-sitter-rust", rev = "00d7cbc95f0b8ea2703129550fbd1853a13e0e29" }
# tree-sitter-ruby = { git = "https://github.com/tree-sitter/tree-sitter-ruby", rev = "89bd7a8e5450cb6a942418a619d30469f259e5d6" }
# tree-sitter-traversal = { git = "https://github.com/skmendez/tree-sitter-traversal", rev = "79ae415626c929e1c7b7c7c3a162ed45c21710bd"}

[dependencies]
num-traits = "0.2"
num-derive = "0.4"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_repr = "0.1"
log = "0.4.21"
env_logger = "0.11.3"
# log2 = "0.1.11"
regex = "1"
tree-sitter = "*"
tree-sitter-rust = "0.24"
tree-sitter-ruby = "0.23.1"
# tree-sitter-elisp = "1.5.0"
# tree-sitter-traversal = { git = "https://github.com/skmendez/tree-sitter-traversal", rev = "79ae415626c929e1c7b7c7c3a162ed45c21710bd"}
tree-sitter-traversal2 = "0.2.0"
indexmap = "1.9.3"
once_cell = "1.10.0"

wee_alloc = "0.4"
console_error_panic_hook = { version = "0.1", optional = true }
wasm-logger = { version = "0.2", optional = true }

schemars = "0.8.2"
schemars-zod = "0.1.5"

futures = "0.3.30"
futures-timer = "3.0.3"
clap = { version = "4.5.4", features = ["derive"] }
# runtime_tracing = "0.14.0" # { git = "https://github.com/metacraft-labs/runtime_tracing.git", branch = "feat-add-evm-event" }

# runtime_tracing = { path = "/home/pesho/code/runtime_tracing/runtime_tracing/"}
runtime_tracing = "0.14.1"
tree-sitter-tracepoint = { path = "./tree-sitter-trace/" }
num-bigint = "0.4.6"
chrono = "0.4.41"

serde-wasm-bindgen = { version = "0.6.5", optional = true}
js-sys = { version = "0.3", optional = true }
wasm-bindgen = { version = "0.2.100", optional = true}
web-sys = { version = "0.3", optional = true, features = [
  "DedicatedWorkerGlobalScope", "WorkerGlobalScope", "console", "MessageEvent",
  "Worker", "Window" ] }

[target.'cfg(target_arch = "x86_64")'.dependencies]
expanduser = "1.2.2"

[lib]
name = "db_backend"
path = "src/lib.rs"
crate-type   = ["rlib", "cdylib"]

[[bin]]
name = "db-backend"
path = "src/main.rs"

[[bin]]
name = "virtualization-layers"
path = "src/bin/virtualization-layers.rs"

[[bin]]
name = "schema-generator"
path = "src/bin/schema_generator.rs"

[env]
SYSROOT = { value = "{cwd}/wasm-sysroot", relative = true }

CC_wasm32_unknown_unknown = "clang"
AR_wasm32_unknown_unknown = "llvm-ar"

CPPFLAGS_wasm32_unknown_unknown = "--target=wasm32 --sysroot={cwd}/wasm-sysroot -isystem {cwd}/wasm-sysroot/include"
CFLAGS_wasm32_unknown_unknown = "-I{cwd}/wasm-sysroot/include -DNDEBUG -Wbad-function-cast -Wcast-function-type -fno-builtin"

[features]
debugging = []

default = ["browser-transport"]

io-transport = []
browser-transport = ["dep:serde-wasm-bindgen", "dep:wasm-bindgen",
  "dep:web-sys", "dep:console_error_panic_hook", "dep:wasm-logger"]
